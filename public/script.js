function constructTable(){var e=document.getElementsByClassName("running-table"),t=runData;console.log(e);for(var a=0;a<e.length;a++){var r=document.createElement("tr"),n=document.createElement("th"),o=document.createElement("th"),i=document.createElement("th"),l=document.createElement("th"),s=document.createElement("th");n.innerHTML="Dist (Km)",o.innerHTML="Time",i.innerHTML="Date",l.innerHTML="Pace",s.innerHTML="Avg HR (BPM)",e[a].appendChild(r),r.appendChild(n),r.appendChild(o),r.appendChild(i),r.appendChild(l),r.appendChild(s),populateTable(e[a],t.splice(0,4))}}function populateTable(e,t){runData.slice(0,4).forEach(function(t){var a=e.insertRow(-1),r=a.insertCell(0),n=a.insertCell(1),o=a.insertCell(2),i=a.insertCell(3),l=a.insertCell(4);r.innerHTML=t.distance,n.innerHTML=t.time,o.innerHTML=t.date,i.innerHTML=t.pace,l.innerHTML=t.heartrate})}function getData(e){var t=[];return Object.keys(e).forEach(function(a){t.push(e[a])}),t}function convertTimeString(e){var t=Math.floor(e/60)+e%60/100;return t.toString().replace(".",":")}function getPace(e,t){var a=(Math.floor(moment.duration(e).asHours()/t)+moment.duration(e).asHours()/t%1*60/60).toFixed(2);return String((Math.floor(a)+a%1*60/100).toFixed(2)).replace(".",":")}console.log("Managed to get all my running data. Suck it Garmin!!"),console.log(stravaData);var runDates=[],maxHeartRates=[],averageSpeeds=[],maxSpeeds=[],exerciseTypes={Run:{value:0,color:"#2196F3",highlight:"#1976D2",label:"Run"},Ride:{value:0,color:"#46BFBD",highlight:"#5AD3D1",label:"Ride"},Swim:{value:0,color:"#FDB45C",highlight:"#FFC870",label:"Swim"},Walk:{value:0,color:"#F44336",highlight:"#D32F2F",label:"Walk"}};const runData=stravaData.filter(function(e){return"Run"==e.type}).map(function(e){return{distance:(.001*e.distance).toFixed(2),time:convertTimeString(e.moving_time),date:moment(e.start_date).format("Do MMM YY"),cadence:e.average_cadence,heartrate:e.average_heartrate,pace:getPace(convertTimeString(e.moving_time),(.001*e.distance).toFixed(2))}}),averageHeartRates=stravaData.filter(function(e){return void 0!=e.average_heartrate}).map(function(e){return e.average_heartrate}).reverse();stravaData.forEach(function(e){void 0!=e.average_heartrate&&(runDates.push(moment(e.start_date).format("Do MMM YY")),maxHeartRates.push(e.max_heartrate),averageSpeeds.push(e.average_speed),maxSpeeds.push(e.max_speed)),exerciseTypes[e.type].value=exerciseTypes[e.type].value+1}),runDates=runDates.reverse(),maxHeartRates=maxHeartRates.reverse(),averageSpeeds=averageSpeeds.reverse(),maxSpeeds=maxSpeeds.reverse(),console.log(runData);var hrData={labels:runDates,datasets:[{label:"Max Heart Rate",fillColor:"#F44336",strokeColor:"#D32F2F",pointColor:"#F44336",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:maxHeartRates},{label:"Average Heart Rate",fillColor:"#2196F3",strokeColor:"#1976D2",pointColor:"#2196F3",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:averageHeartRates}]},hrCtx=document.getElementById("heart_rate_chart").getContext("2d"),heartRateChart=new Chart(hrCtx).Line(hrData,{responsive:!0,maintainAspectRatio:!1});legend(document.getElementById("heart_rate_chart_placeholder"),hrData);var speedData={labels:runDates,datasets:[{label:"Max Speed",fillColor:"#F44336",strokeColor:"#D32F2F",pointColor:"#F44336",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:maxSpeeds},{label:"Average Speed",fillColor:"#2196F3",strokeColor:"#1976D2",pointColor:"#2196F3",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:averageSpeeds}]},speedCtx=document.getElementById("speed_chart").getContext("2d"),speedChart=new Chart(speedCtx).Line(speedData,{responsive:!0,maintainAspectRatio:!1});legend(document.getElementById("speed_chart_placeholder"),speedData);var exerciseCTX=document.getElementById("exercise_chart").getContext("2d"),exercisePieChart=new Chart(exerciseCTX).Doughnut(getData(exerciseTypes));legend(document.getElementById("exercise_chart_placeholder"),getData(exerciseTypes)),constructTable();